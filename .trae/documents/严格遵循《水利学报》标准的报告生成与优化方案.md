# 基于《水利学报》版式规范的最终执行方案

收到您提供的版式要求图片。这解决了所有关于格式的不确定性。我将立即废弃之前的猜测，**严格按照图片中的参数**重写生成逻辑。

## 核心参数映射 (基于您提供的图片)
我已将图片中的自然语言要求转换为代码参数：
*   **正文**：`5号宋体` (10.5pt SimSun)，通栏排版。
*   **一级标题**：`4号宋体` (14pt SimSun)，左对齐，**占3行**。
*   **二级标题**：`5号黑体` (10.5pt SimHei)，左对齐，占1行。
*   **三级标题**：`5号楷体` (10.5pt KaiTi)，左对齐，占1行。
*   **文章标题**：`3号黑体` (16pt SimHei)，上下各空一行。
*   **图表说明**：居中，后空7号字位置。

## 执行步骤

### 第一步：构建《水利学报》专用样式库 (Style Definition)
不再依赖通用的 Markdown 转 Word 库，而是直接调用 `python-docx` 的底层 API 创建专属样式。
*   **动作**：创建 `ml_backend/academic_formatter.py`。
*   **逻辑**：
    *   注册 "Hohai-Body" 样式：字体设为 SimSun (宋体)，字号 10.5pt。
    *   注册 "Hohai-Header1" 样式：字体 SimSun，字号 14pt，段前段后间距设置为凑足3行高度。
    *   注册 "Hohai-Header2" 样式：字体 SimHei (黑体)，字号 10.5pt。
    *   注册 "Hohai-Table" 样式：字体 SimSun，字号 7.5pt (6号)。

### 第二步：深度清洗与内容重组 (Content Refactoring)
解决“Markdown符号残留”和“只有一行话”的问题。
*   **动作**：更新 `generate_report.py`。
*   **逻辑**：
    *   **强制纯文本化**：使用正则表达式 `re.sub(r'[*#]', '', text)` 彻底清除所有 `*` 和 `#`。
    *   **结构化解析**：将报告内容解析为 `[Title, Abstract, Section, Subsection, Chart]` 的对象树，而不是一坨长文本。
    *   **真实数据注入**：读取 `assets/real_trend.png` (引张线真实数据) 和 `assets/er_diagram.png` (ER图) 并按“图说一行居中”的规则插入。

### 第三步：生成最终交付物 (Final Production)
*   **动作**：执行生成脚本。
*   **产出**：`智慧水利监测平台_项目报告书_水利学报版.docx`。
*   **验证**：
    *   **字数**：> 8000字。
    *   **图表**：包含 ER 图、流程图、真实数据统计图。
    *   **格式**：无 `*` 号，字体字号完全匹配图片要求。

### 第四步：清理与交付
*   删除所有中间产生的临时文件和乱码文件。
*   将最终文档放入 `课设材料/项目交付物/项目报告/` 文件夹。

---
**请确认**：
是否立即开始按照此**精确参数**执行代码编写与报告生成？